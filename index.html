<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cash receipt - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏¥‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</title>
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        :root { --theme-color: #2c3e50; --bg-color: #f3f4f6; }
        body { font-family: 'Sarabun', sans-serif; background-color: var(--bg-color); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        .controls { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; width: 100%; justify-content: center; padding-bottom: 5px; }
        button { padding: 8px 12px; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-save { background-color: #198754; color: white; }
        .btn-history { background-color: #ffc107; color: #000; }
        .btn-export { background-color: #0d6efd; color: white; }
        .btn-clear { background-color: #dc3545; color: white; }
        .btn-add { background-color: var(--theme-color); color: white; width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; }
        .bill-paper { background: white; width: 100%; max-width: 400px; padding: 25px 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; box-sizing: border-box; border-top: 6px solid var(--theme-color); }
        .editable-input { width: 100%; border: none; background: transparent; font-family: 'Sarabun', sans-serif; outline: none; }
        .header-section { display: flex; justify-content: space-between; margin-bottom: 12px; }
        .shop-name { font-size: 1.4rem; font-weight: 700; color: var(--theme-color); }
        .shop-addr { font-size: 0.8rem; color: #444; min-height: 4.5em; line-height: 1.4; resize: none; width: 100%; }
        .input-row { display: flex; align-items: baseline; margin-bottom: 6px; font-size: 0.9rem; }
        .input-row label { color: var(--theme-color); font-weight: 600; min-width: 100px; font-size: 0.75rem; }
        .input-row input { flex: 1; border: none; border-bottom: 1px dotted #ccc; font-size: 0.95rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background-color: #eee; border: 1px solid var(--theme-color); padding: 4px; font-size: 0.7rem; }
        td { border: 1px solid #ddd; padding: 6px 4px; }
        .summary-line { display: flex; justify-content: space-between; padding: 3px 10px; font-size: 0.85rem; }
        .total-line { display: flex; justify-content: space-between; padding: 8px 10px; background: var(--theme-color); color: white; font-weight: bold; border-radius: 4px; margin-top: 5px; }
        .baht-text { font-size: 0.65rem; text-align: right; margin-top: 5px; color: #555; }
        .credit-text { text-align: center; font-size: 0.7rem; color: #aaa; margin-top: 30px; line-height: 1.6; }
        #snapshot-container { position: absolute; top: -9999px; left: -9999px; width: 400px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
        .modal-content { background: white; margin: 10% auto; padding: 20px; width: 90%; max-width: 350px; border-radius: 8px; }
    </style>
</head>
<body>

    <div class="controls">
        <button class="btn-save" onclick="saveBill()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (Save)</button>
        <button class="btn-history" onclick="openHistory()">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (History)</button>
        <button class="btn-export" onclick="exportImage()">üì∏ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Image)</button>
        <button class="btn-clear" onclick="createNew()">üìÑ ‡πÉ‡∏´‡∏°‡πà (New)</button>
    </div>

    <div id="billEditor" class="bill-paper">
        <div class="header-section">
            <div style="width: 65%;">
                <input type="text" class="editable-input shop-name" id="shopName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô / Shop Name" onchange="saveShopInfo()">
                <textarea class="editable-input shop-addr" id="shopAddr" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ / Address & Tel" onchange="saveShopInfo()"></textarea>
            </div>
            <div style="text-align: right; font-size: 0.7rem;">
                <b>No.</b> <input type="text" id="billNo" style="width:60px; border:none; border-bottom:1px solid #000; text-align:center;" readonly><br>
                <b>Date:</b> <input type="date" id="billDate" style="border:none; font-family:'Sarabun';">
            </div>
        </div>

        <div class="customer-info">
            <div class="input-row"><label>‡∏ô‡∏≤‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ / Name:</label><input type="text" id="custName"></div>
            <div class="input-row"><label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà / Address:</label><input type="text" id="custAddr"></div>
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width:15%;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô<br>Qty</th>
                    <th style="width:50%;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£<br>Description</th>
                    <th style="width:15%;">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏•‡∏∞<br>Price</th>
                    <th style="width:20%;">‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô<br>Amount</th>
                </tr>
            </thead>
            <tbody id="itemsBody"></tbody>
        </table>
        <button class="btn-add" onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (Add Item)</button>

        <div style="margin-top: 15px;">
            <div class="summary-line"><span>‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô / Subtotal</span><span id="subTotal">0.00</span></div>
            <div class="summary-line"><span>‡∏†‡∏≤‡∏©‡∏µ 7% / VAT 7%</span><span id="vatAmount">0.00</span></div>
            <div class="total-line"><span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ / Grand Total</span><span id="grandTotal">0.00</span></div>
            <div class="baht-text" id="bahtText">( ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô / Zero Baht Only )</div>
        </div>

        <textarea id="paymentInfo" style="width:100%; margin-top:10px; font-size:0.7rem; height:40px; border:1px dashed #ccc;" placeholder="‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà... (Payment info)" onchange="saveShopInfo()"></textarea>

        <div class="credit-text">
            <strong>Cash receipt App | Version 1.1.0</strong><br>
            ¬© 2026 All Rights Reserved | Developed by Gemini & Ton7788<br>
            Contact: +66 88 897 7466
        </div>
    </div>

    <div id="snapshot-container"></div>
    <div id="historyModal" class="modal"><div class="modal-content"><h3 style="margin-top:0;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏¥‡∏• (History)</h3><div id="historyList"></div><button onclick="document.getElementById('historyModal').style.display='none'" style="width:100%; margin-top:10px;">‡∏õ‡∏¥‡∏î (Close)</button></div></div>

    <script>
        const STORAGE_KEY_HISTORY = 'cash_receipt_history';
        const STORAGE_KEY_CONFIG = 'cash_receipt_config';
        let currentBillId = null;

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('billDate').valueAsDate = new Date();
            loadShopInfo();
            generateBillNo();
            addRow();
            if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
        });

        function addRow(data = {}) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><input type="number" class="editable-input qty" style="text-align:center" value="${data.qty || ''}" onkeyup="calcTotal()"></td>
                <td><input type="text" class="editable-input desc" value="${data.desc || ''}"></td>
                <td><input type="number" class="editable-input price" style="text-align:right" value="${data.price || ''}" onkeyup="calcTotal()"></td>
                <td style="text-align:right" class="row-total">${data.total || ''}</td>
            `;
            document.getElementById('itemsBody').appendChild(tr);
        }

        function calcTotal() {
            let subtotal = 0;
            document.querySelectorAll('#itemsBody tr').forEach(row => {
                const q = parseFloat(row.querySelector('.qty').value) || 0;
                const p = parseFloat(row.querySelector('.price').value) || 0;
                const sum = q * p;
                row.querySelector('.row-total').innerText = sum > 0 ? sum.toFixed(2) : '';
                subtotal += sum;
            });
            const vat = subtotal * 0.07;
            const grand = subtotal + vat;
            document.getElementById('subTotal').innerText = subtotal.toFixed(2);
            document.getElementById('vatAmount').innerText = vat.toFixed(2);
            document.getElementById('grandTotal').innerText = grand.toFixed(2);
            document.getElementById('bahtText').innerText = `( ${ThaiBaht(grand)} / ${grand.toFixed(2)} Baht Only )`;
        }

        function saveShopInfo() {
            localStorage.setItem(STORAGE_KEY_CONFIG, JSON.stringify({
                name: document.getElementById('shopName').value,
                addr: document.getElementById('shopAddr').value,
                pay: document.getElementById('paymentInfo').value
            }));
        }

        function loadShopInfo() {
            const config = JSON.parse(localStorage.getItem(STORAGE_KEY_CONFIG));
            if (config) {
                document.getElementById('shopName').value = config.name || '';
                document.getElementById('shopAddr').value = config.addr || '';
                document.getElementById('paymentInfo').value = config.pay || '';
            }
        }

        function generateBillNo() {
            const now = new Date();
            const prefix = `${(now.getFullYear()+543).toString().slice(-2)}${String(now.getMonth()+1).padStart(2,'0')}`;
            document.getElementById('billNo').value = `${prefix}-${Math.floor(Math.random()*900)+100}`;
        }

        function saveBill() {
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! (Saved to device)');
            // logic for localstorage history...
        }

        function exportImage() {
            const source = document.getElementById('billEditor');
            html2canvas(source, { scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Bill-${document.getElementById('billNo').value}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function createNew() { if(confirm('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•‡πÉ‡∏´‡∏°‡πà?')) location.reload(); }

        function ThaiBaht(n) {
            if (!n || n==0) return "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";
            const numbers = ["‡∏®‡∏π‡∏ô‡∏¢‡πå", "‡∏´‡∏ô‡∏∂‡πà‡∏á", "‡∏™‡∏≠‡∏á", "‡∏™‡∏≤‡∏°", "‡∏™‡∏µ‡πà", "‡∏´‡πâ‡∏≤", "‡∏´‡∏Å", "‡πÄ‡∏à‡πá‡∏î", "‡πÅ‡∏õ‡∏î", "‡πÄ‡∏Å‡πâ‡∏≤"];
            const units = ["", "‡∏™‡∏¥‡∏ö", "‡∏£‡πâ‡∏≠‡∏¢", "‡∏û‡∏±‡∏ô", "‡∏´‡∏°‡∏∑‡πà‡∏ô", "‡πÅ‡∏™‡∏ô", "‡∏•‡πâ‡∏≤‡∏ô"];
            let s = n.toFixed(2).split('.');
            let baht = s[0], satang = s[1], text = "";
            for (let i = 0; i < baht.length; i++) {
                let num = parseInt(baht.charAt(i)), unitIndex = baht.length - i - 1;
                if (num === 0) continue;
                if (unitIndex === 1 && num === 2) text += "‡∏¢‡∏µ‡πà";
                else if (unitIndex === 1 && num === 1) text += "";
                else if (unitIndex === 0 && num === 1 && baht.length > 1) text += "‡πÄ‡∏≠‡πá‡∏î";
                else text += numbers[num];
                text += units[unitIndex];
            }
            text += "‡∏ö‡∏≤‡∏ó" + (parseInt(satang) === 0 ? "‡∏ñ‡πâ‡∏ß‡∏ô" : satang + "‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå");
            return text;
        }
    </script>
</body>
</html>